function sendDataToAirtable(data,slug,callback){const url=`/wp-json/connectAirtable/v1/airtable`;const headers=new Headers({"Content-Type":"application/json",});var client=themeOptions.clientValue;const requestOptions={method:"POST",headers:headers,body:JSON.stringify({fields:{"Phone Number":data.Phone_Number,"User Agent":data.User_Agent,Source:data.Source,"IP Address":data.IP_Address,GCLID:data.GCLID,Network:data.Network,Slug:slug,"RAW Source":data.Referrer,"Cookie Source":data.Prev_URL,Client:client,},}),};fetch(url,requestOptions).then((response)=>response.json()).then((data)=>{console.log(data);if(data){callback(!0)}else{callback(!1)}}).catch((error)=>{console.error("Error:",error);callback(!1)})}
function setCookie(name,value,days){var expires="";if(days){var date=new Date();date.setTime(date.getTime()+days*24*60*60*1000);expires="; expires="+date.toUTCString()}
document.cookie=name+"="+(value||"")+expires+"; path=/"}
function getCookie(name){var value="; "+document.cookie;var parts=value.split("; "+name+"=");if(parts.length==2)return parts.pop().split(";").shift()}
function mapUtmSourceToSimplifiedSource(utmSource){const sourceMapping={google:"paid_search",gclid:"paid_search",};return sourceMapping[utmSource]||"organic"}
const urlPrefixToNumberIndexMap={"/ppc/help-to-buy-remortgage-ppc/":1,};function getIndexForUrl(url){const urlPrefix=Object.keys(urlPrefixToNumberIndexMap).find((prefix)=>url.includes(prefix));return urlPrefix?urlPrefixToNumberIndexMap[urlPrefix]:null}
document.addEventListener("DOMContentLoaded",function(){var client=themeOptions.clientValue;var params=new URLSearchParams(window.location.search);var gclid=params.get("gclid")||getCookie("gclid");var network=params.get("network");var utmSource=params.get("utm_source");var slug=window.location.pathname.split("/").filter(Boolean).pop();var referrer=document.referrer;const currentUrl=window.location.pathname;const phoneNumberIndex=getIndexForUrl(currentUrl);const fromSearchEngine=isFromSearchEngine(referrer);const typedDirectly=referrer==="Direct"&&document.referrer==="";function isFromSearchEngine(referrer){const searchEngines=["google.com","bing.com","yahoo.com","duckduckgo.com","baidu.com","yandex.com",];return searchEngines.some((searchEngine)=>referrer.toLowerCase().includes(searchEngine))}
var bodyDataSource=utmSource?mapUtmSourceToSimplifiedSource(utmSource.toLowerCase()):fromSearchEngine?"organic":typedDirectly?"direct":document.body.getAttribute("data-source");if(localStorage.getItem("prevURL")){var prevURL=localStorage.getItem("prevURL");console.log("Previous URL:",prevURL)}
localStorage.setItem("prevURL",window.location.href);const phoneNumberElements=document.querySelectorAll(".phone-number");let storedPhoneNumber=getCookie("twilioPhoneNumber");if(storedPhoneNumber){phoneNumberElements.forEach((element)=>{element.href=`tel:${storedPhoneNumber.replace(/\s+/g, "")}`;element.textContent=storedPhoneNumber})}
if(params.get("gclid")){setCookie("gclid",params.get("gclid"),30)}
if(gclid||getCookie("gclid")){fetch(`/wp-json/tle-theme/phone-numbers?simplifiedSource=paid_search`).then((response)=>{if(!response.ok){console.error("Error fetching phone numbers:",response.statusText);throw new Error("Error fetching phone numbers")}
return response.json()}).then((twilioNumbers)=>{if(twilioNumbers&&twilioNumbers.length>0){const selectedNumber=phoneNumberIndex!==null&&twilioNumbers[phoneNumberIndex]?twilioNumbers[phoneNumberIndex]:twilioNumbers[0];setCookie("twilioPhoneNumber",selectedNumber,30);phoneNumberElements.forEach((element)=>{element.href=`tel:${selectedNumber.replace(/\s+/g, "")}`;element.textContent=selectedNumber});var data={Phone_Number:selectedNumber,User_Agent:navigator.userAgent,IP_Address:document.body.getAttribute("data-ip-address"),GCLID:gclid,Network:network,Source:bodyDataSource,Referrer:referrer,Prev_URL:prevURL,Client:client,};var gclidFromCookie=getCookie("gclid");if(gclidFromCookie){data.GCLID=gclidFromCookie}
sendDataToAirtable(data,slug,function(response){if(response){console.log("Data sent to Airtable")}else{console.log("Failed to send data to Airtable")}})}}).catch((error)=>{console.error("An error occurred while fetching the Twilio numbers:",error)})}})